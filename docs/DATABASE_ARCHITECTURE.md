# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

## ğŸ—„ï¸ ç’°å¢ƒåˆ¥ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹æˆ

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

```
é¸æŠè‚¢1: ãƒ­ãƒ¼ã‚«ãƒ«MySQLï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º                    â”‚
â”‚  â”œâ”€â”€ Frontend (localhost:3000)  â”‚
â”‚  â”œâ”€â”€ Backend (localhost:8000)   â”‚
â”‚  â””â”€â”€ MySQL (Docker Container)   â”‚
â”‚      â””â”€â”€ localhost:3306         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é¸æŠè‚¢2: Aurora MySQLï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º                    â”‚
â”‚  â”œâ”€â”€ Frontend (localhost:3000)  â”‚
â”‚  â”œâ”€â”€ Backend (localhost:8000)   â”‚
â”‚  â””â”€â”€ Aurora MySQL (AWS)         â”‚
â”‚      â””â”€â”€ xxx.cluster-xxx.rds... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### AWS ç’°å¢ƒ

```
é–‹ç™ºç’°å¢ƒ (develop ãƒ–ãƒ©ãƒ³ãƒ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AWS é–‹ç™ºç’°å¢ƒ                    â”‚
â”‚  â”œâ”€â”€ Frontend (CloudFront)      â”‚
â”‚  â”œâ”€â”€ Backend (Lambda)           â”‚
â”‚  â””â”€â”€ Aurora MySQL               â”‚
â”‚      â””â”€â”€ dev-cluster.rds...     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ (main ãƒ–ãƒ©ãƒ³ãƒ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AWS ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ            â”‚
â”‚  â”œâ”€â”€ Frontend (CloudFront)      â”‚
â”‚  â”œâ”€â”€ Backend (Lambda)           â”‚
â”‚  â””â”€â”€ Aurora MySQL               â”‚
â”‚      â””â”€â”€ staging-cluster.rds... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æœ¬ç•ªç’°å¢ƒ (æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AWS æœ¬ç•ªç’°å¢ƒ                    â”‚
â”‚  â”œâ”€â”€ Frontend (CloudFront)      â”‚
â”‚  â”œâ”€â”€ Backend (Lambda)           â”‚
â”‚  â””â”€â”€ Aurora MySQL               â”‚
â”‚      â””â”€â”€ prod-cluster.rds...    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ‡ã‚Šæ›¿ãˆ

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã®åˆ‡ã‚Šæ›¿ãˆ

#### 1. ãƒ­ãƒ¼ã‚«ãƒ« MySQL ä½¿ç”¨ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰

```bash
make use-local-db
make dev-restart
```

**ç‰¹å¾´:**

- âœ… é«˜é€Ÿãƒ»è»½é‡
- âœ… ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ä½œæ¥­å¯èƒ½
- âœ… å®Œå…¨ã«ç‹¬ç«‹ã—ãŸç’°å¢ƒ
- âœ… ç„¡æ–™
- âŒ ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã¨ã®å·®ç•°

#### 2. Aurora MySQL ä½¿ç”¨ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```bash
make setup-aurora      # åˆå›ã®ã¿
make sync-to-aurora     # ãƒ‡ãƒ¼ã‚¿åŒæœŸ
make use-aurora-db
make dev-restart
```

**ç‰¹å¾´:**

- âœ… æœ¬ç•ªç’°å¢ƒã¨åŒã˜ã‚¤ãƒ³ãƒ•ãƒ©
- âœ… ã‚¯ãƒ©ã‚¦ãƒ‰ã§ã®ãƒ†ã‚¹ãƒˆ
- âœ… ãƒãƒ¼ãƒ é–“ã§ã®ãƒ‡ãƒ¼ã‚¿å…±æœ‰
- âŒ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šå¿…è¦
- âŒ AWS æ–™é‡‘ç™ºç”Ÿ

## ğŸ“‹ ãƒ‡ãƒ¼ã‚¿åŒæœŸ

### ãƒ­ãƒ¼ã‚«ãƒ« â†’ Aurora

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’Auroraã«åŒæœŸ
make sync-to-aurora
```

### Aurora â†’ ãƒ­ãƒ¼ã‚«ãƒ«

```bash
# Auroraã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«åŒæœŸï¼ˆé€†æ–¹å‘ï¼‰
./scripts/sync-aurora-to-local.sh  # ä»Šå¾Œå®Ÿè£…äºˆå®š
```

## ğŸ¯ æ¨å¥¨ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³

### æ—¥å¸¸é–‹ç™º

```bash
# é€šå¸¸ã¯ãƒ­ãƒ¼ã‚«ãƒ«MySQLã‚’ä½¿ç”¨
make use-local-db
```

### ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ†ã‚¹ãƒˆ

```bash
# ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆãŒå¿…è¦ãªå ´åˆ
make use-aurora-db
```

### ãƒãƒ¼ãƒ é–‹ç™º

```bash
# ãƒãƒ¼ãƒ ã§ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã—ãŸã„å ´åˆ
make sync-to-aurora
make use-aurora-db
```

## ğŸ”§ ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«

### ãƒ­ãƒ¼ã‚«ãƒ« MySQL ç”¨

```bash
# backend/.env.dev
DB_HOST=mysql
DB_PORT=3306
DATABASE_URL=mysql+pymysql://dev_user:dev_password@mysql:3306/csr_lambda_dev
```

### Aurora MySQL ç”¨

```bash
# backend/.env.dev.aurora
DB_HOST=csr-lambda-api-dev-aurora.cluster-xxx.ap-northeast-1.rds.amazonaws.com
DB_PORT=3306
DATABASE_URL=mysql+pymysql://dev_user:DevPassword123!@aurora-endpoint:3306/csr_lambda_dev
```

## ğŸ’° ã‚³ã‚¹ãƒˆè€ƒæ…®

### ãƒ­ãƒ¼ã‚«ãƒ« MySQL

- **ã‚³ã‚¹ãƒˆ**: ç„¡æ–™
- **ãƒªã‚½ãƒ¼ã‚¹**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã®ã¿

### Aurora MySQL

- **ã‚³ã‚¹ãƒˆ**: AWS æ–™é‡‘ç™ºç”Ÿ
  - Aurora Serverless v2: ä½¿ç”¨é‡ã«å¿œã˜ãŸèª²é‡‘
  - æœ€å°: ~$0.5/æ™‚é–“ï¼ˆã‚¢ã‚¤ãƒ‰ãƒ«æ™‚ã¯ä½ã‚³ã‚¹ãƒˆï¼‰
- **ãƒªã‚½ãƒ¼ã‚¹**: AWS ç®¡ç†

## ğŸš¨ æ³¨æ„äº‹é …

1. **ãƒ‡ãƒ¼ã‚¿ã®ç‹¬ç«‹æ€§**: ãƒ­ãƒ¼ã‚«ãƒ«ã¨ Aurora ã¯ç‹¬ç«‹ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
2. **åŒæœŸã®æ–¹å‘æ€§**: æ‰‹å‹•åŒæœŸãŒå¿…è¦
3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: Aurora ã¯é©åˆ‡ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®šãŒå¿…è¦
4. **ã‚³ã‚¹ãƒˆç®¡ç†**: Aurora ä½¿ç”¨æ™‚ã¯ AWS æ–™é‡‘ã«æ³¨æ„

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Aurora æ¥ç¶šã‚¨ãƒ©ãƒ¼

```bash
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®ç¢ºèª
aws ec2 describe-security-groups --group-names csr-lambda-api-dev-aurora-sg

# æ¥ç¶šãƒ†ã‚¹ãƒˆ
mysql -h your-aurora-endpoint -u dev_user -p
```

### ãƒ‡ãƒ¼ã‚¿åŒæœŸã‚¨ãƒ©ãƒ¼

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«MySQLç¢ºèª
docker exec -it csr-lambda-mysql mysql -u dev_user -p

# Auroraç¢ºèª
mysql -h your-aurora-endpoint -u dev_user -p
```
