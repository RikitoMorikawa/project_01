name: Test Secrets Configuration

on:
  workflow_dispatch:
  push:
    branches: [test-secrets]

env:
  AWS_REGION: ap-northeast-1

jobs:
  test-secrets:
    name: Secrets шинхоЪуГЖуВ╣уГИ
    runs-on: ubuntu-latest

    steps:
      - name: уВ│уГ╝уГЙуВТуГБуВзуГГуВпуВвуВжуГИ
        uses: actions/checkout@v4

      - name: AWS шкНши╝цГЕха▒уВТшинхоЪ
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ env.AWS_REGION }}

      - name: Secrets уБохнШхЬичв║шкН
        run: |
          echo "=== Secrets хнШхЬичв║шкН ==="
          if [ -n "${{ secrets.AWS_ACCESS_KEY_ID }}" ]; then
            echo "тЬЕ AWS_ACCESS_KEY_ID: шинхоЪц╕ИуБ┐"
          else
            echo "тЭМ AWS_ACCESS_KEY_ID: цЬкшинхоЪ"
            exit 1
          fi

          if [ -n "${{ secrets.AWS_SECRET_ACCESS_KEY }}" ]; then
            echo "тЬЕ AWS_SECRET_ACCESS_KEY: шинхоЪц╕ИуБ┐"
          else
            echo "тЭМ AWS_SECRET_ACCESS_KEY: цЬкшинхоЪ"
            exit 1
          fi

      - name: AWS цОеч╢ЪуГЖуВ╣уГИ
        run: |
          echo "=== AWS цОеч╢ЪуГЖуВ╣уГИ ==="

          # шкНши╝цГЕха▒чв║шкН
          echo "шкНши╝цГЕха▒уВТчв║шкНф╕н..."
          aws sts get-caller-identity

          echo ""
          echo "=== хЯ║цЬмцийщЩРуГЖуВ╣уГИ ==="

          # S3 цийщЩРуГЖуВ╣уГИ
          echo -n "S3 цийщЩР: "
          if aws s3 ls >/dev/null 2>&1; then
            echo "тЬЕ OK"
          else
            echo "тЭМ NG"
          fi

          # Lambda цийщЩРуГЖуВ╣уГИ
          echo -n "Lambda цийщЩР: "
          if aws lambda list-functions --max-items 1 >/dev/null 2>&1; then
            echo "тЬЕ OK"
          else
            echo "тЭМ NG"
          fi

          # CloudFormation цийщЩРуГЖуВ╣уГИ
          echo -n "CloudFormation цийщЩР: "
          if aws cloudformation list-stacks --max-items 1 >/dev/null 2>&1; then
            echo "тЬЕ OK"
          else
            echo "тЭМ NG"
          fi

      - name: уГЖуВ╣уГИч╡РцЮЬуВ╡уГЮуГкуГ╝
        run: |
          echo ""
          echo "ЁЯОЙ Secrets шинхоЪуГЖуВ╣уГИуБМхоМф║ЖуБЧуБ╛уБЧуБЯя╝Б"
          echo ""
          echo "тЬЕ AWS шкНши╝цГЕха▒: цнгх╕╕"
          echo "тЬЕ хЯ║цЬмцийщЩР: чв║шкНц╕ИуБ┐"
          echo "тЬЕ GitHub Actions ч╡▒хРИ: цнгх╕╕"
