AWSTemplateFormatVersion: "2010-09-09"
Description: "CSR Lambda API System - Staging Environment CloudWatch Monitoring and Alarms"

Parameters:
  ProjectName:
    Type: String
    Default: csr-lambda-api
    Description: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå

  Environment:
    Type: String
    Default: staging
    Description: ç’°å¢ƒå

  NotificationEmail:
    Type: String
    Default: ""
    Description: ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥ç”¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

  SlackWebhookUrl:
    Type: String
    Default: ""
    Description: Slack Webhook URLï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    NoEcho: true

Conditions:
  HasNotificationEmail: !Not [!Equals [!Ref NotificationEmail, ""]]
  HasSlackWebhook: !Not [!Equals [!Ref SlackWebhookUrl, ""]]

Resources:
  # SNS ãƒˆãƒ”ãƒƒã‚¯ï¼ˆã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥ç”¨ï¼‰
  AlertTopic:
    Type: AWS::SNS::Topic
    Properties:
      TopicName: !Sub "${ProjectName}-${Environment}-alerts"
      DisplayName: !Sub "${ProjectName} ${Environment} Alerts"
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-alerts"
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName

  # ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³
  EmailSubscription:
    Type: AWS::SNS::Subscription
    Condition: HasNotificationEmail
    Properties:
      TopicArn: !Ref AlertTopic
      Protocol: email
      Endpoint: !Ref NotificationEmail

  # Lambda é–¢æ•°ç›£è¦–ç”¨ CloudWatch ã‚¢ãƒ©ãƒ¼ãƒ ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒç”¨ã«èª¿æ•´ï¼‰
  LambdaErrorRateAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: !Sub "${ProjectName}-${Environment}-lambda-error-rate"
      AlarmDescription: "Lambda é–¢æ•°ã®ã‚¨ãƒ©ãƒ¼ç‡ãŒé«˜ã„å ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ"
      MetricName: Errors
      Namespace: AWS/Lambda
      Statistic: Sum
      Period: 300
      EvaluationPeriods: 2
      Threshold: 3 # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ã¯ä½ã‚ã«è¨­å®š
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value:
            Fn::ImportValue: !Sub "${ProjectName}-${Environment}-lambda-function-name"
      AlarmActions:
        - !Ref AlertTopic
      OKActions:
        - !Ref AlertTopic
      TreatMissingData: notBreaching
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-lambda-error-rate"
        - Key: Environment
          Value: !Ref Environment

  LambdaDurationAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: !Sub "${ProjectName}-${Environment}-lambda-duration"
      AlarmDescription: "Lambda é–¢æ•°ã®å®Ÿè¡Œæ™‚é–“ãŒé•·ã„å ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ"
      MetricName: Duration
      Namespace: AWS/Lambda
      Statistic: Average
      Period: 300
      EvaluationPeriods: 2
      Threshold: 25000 # 25ç§’
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value:
            Fn::ImportValue: !Sub "${ProjectName}-${Environment}-lambda-function-name"
      AlarmActions:
        - !Ref AlertTopic
      TreatMissingData: notBreaching
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-lambda-duration"
        - Key: Environment
          Value: !Ref Environment

  LambdaThrottleAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: !Sub "${ProjectName}-${Environment}-lambda-throttles"
      AlarmDescription: "Lambda é–¢æ•°ãŒã‚¹ãƒ­ãƒƒãƒˆãƒ«ã•ã‚ŒãŸå ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ"
      MetricName: Throttles
      Namespace: AWS/Lambda
      Statistic: Sum
      Period: 300
      EvaluationPeriods: 1
      Threshold: 1
      ComparisonOperator: GreaterThanOrEqualToThreshold
      Dimensions:
        - Name: FunctionName
          Value:
            Fn::ImportValue: !Sub "${ProjectName}-${Environment}-lambda-function-name"
      AlarmActions:
        - !Ref AlertTopic
      TreatMissingData: notBreaching
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-lambda-throttles"
        - Key: Environment
          Value: !Ref Environment

  LambdaConcurrentExecutionsAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: !Sub "${ProjectName}-${Environment}-lambda-concurrent-executions"
      AlarmDescription: "Lambda é–¢æ•°ã®åŒæ™‚å®Ÿè¡Œæ•°ãŒå¤šã„å ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ"
      MetricName: ConcurrentExecutions
      Namespace: AWS/Lambda
      Statistic: Maximum
      Period: 300
      EvaluationPeriods: 2
      Threshold: 50 # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã®åŒæ™‚å®Ÿè¡Œæ•°åˆ¶é™
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: FunctionName
          Value:
            Fn::ImportValue: !Sub "${ProjectName}-${Environment}-lambda-function-name"
      AlarmActions:
        - !Ref AlertTopic
      TreatMissingData: notBreaching
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-lambda-concurrent-executions"
        - Key: Environment
          Value: !Ref Environment

  # API Gateway ç›£è¦–ç”¨ CloudWatch ã‚¢ãƒ©ãƒ¼ãƒ 
  ApiGateway4xxErrorAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: !Sub "${ProjectName}-${Environment}-api-4xx-errors"
      AlarmDescription: "API Gateway ã® 4xx ã‚¨ãƒ©ãƒ¼ç‡ãŒé«˜ã„å ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ"
      MetricName: 4XXError
      Namespace: AWS/ApiGateway
      Statistic: Sum
      Period: 300
      EvaluationPeriods: 2
      Threshold: 5 # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ã¯ä½ã‚ã«è¨­å®š
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: ApiName
          Value: !Sub "${ProjectName}-${Environment}-api"
        - Name: Stage
          Value: v1
      AlarmActions:
        - !Ref AlertTopic
      TreatMissingData: notBreaching
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-api-4xx-errors"
        - Key: Environment
          Value: !Ref Environment

  ApiGateway5xxErrorAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: !Sub "${ProjectName}-${Environment}-api-5xx-errors"
      AlarmDescription: "API Gateway ã® 5xx ã‚¨ãƒ©ãƒ¼ç‡ãŒé«˜ã„å ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ"
      MetricName: 5XXError
      Namespace: AWS/ApiGateway
      Statistic: Sum
      Period: 300
      EvaluationPeriods: 1
      Threshold: 1
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: ApiName
          Value: !Sub "${ProjectName}-${Environment}-api"
        - Name: Stage
          Value: v1
      AlarmActions:
        - !Ref AlertTopic
      TreatMissingData: notBreaching
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-api-5xx-errors"
        - Key: Environment
          Value: !Ref Environment

  ApiGatewayLatencyAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: !Sub "${ProjectName}-${Environment}-api-latency"
      AlarmDescription: "API Gateway ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ãŒé•·ã„å ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ"
      MetricName: Latency
      Namespace: AWS/ApiGateway
      Statistic: Average
      Period: 300
      EvaluationPeriods: 2
      Threshold: 3000 # 3ç§’ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ã¯å³ã—ã‚ï¼‰
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: ApiName
          Value: !Sub "${ProjectName}-${Environment}-api"
        - Name: Stage
          Value: v1
      AlarmActions:
        - !Ref AlertTopic
      TreatMissingData: notBreaching
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-api-latency"
        - Key: Environment
          Value: !Ref Environment

  # Aurora ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç›£è¦–ç”¨ CloudWatch ã‚¢ãƒ©ãƒ¼ãƒ 
  DatabaseCPUAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: !Sub "${ProjectName}-${Environment}-db-cpu-utilization"
      AlarmDescription: "Aurora ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã® CPU ä½¿ç”¨ç‡ãŒé«˜ã„å ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ"
      MetricName: CPUUtilization
      Namespace: AWS/RDS
      Statistic: Average
      Period: 300
      EvaluationPeriods: 2
      Threshold: 70 # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ã¯ä½ã‚ã«è¨­å®š
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: DBClusterIdentifier
          Value: !Sub "${ProjectName}-${Environment}-aurora-cluster"
      AlarmActions:
        - !Ref AlertTopic
      TreatMissingData: notBreaching
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-db-cpu-utilization"
        - Key: Environment
          Value: !Ref Environment

  DatabaseConnectionsAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: !Sub "${ProjectName}-${Environment}-db-connections"
      AlarmDescription: "Aurora ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ¥ç¶šæ•°ãŒå¤šã„å ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ"
      MetricName: DatabaseConnections
      Namespace: AWS/RDS
      Statistic: Average
      Period: 300
      EvaluationPeriods: 2
      Threshold: 60 # t3.small ã®æœ€å¤§æ¥ç¶šæ•°ã®60%
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: DBClusterIdentifier
          Value: !Sub "${ProjectName}-${Environment}-aurora-cluster"
      AlarmActions:
        - !Ref AlertTopic
      TreatMissingData: notBreaching
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-db-connections"
        - Key: Environment
          Value: !Ref Environment

  DatabaseReadLatencyAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: !Sub "${ProjectName}-${Environment}-db-read-latency"
      AlarmDescription: "Aurora ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®èª­ã¿å–ã‚Šãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãŒé«˜ã„å ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ"
      MetricName: ReadLatency
      Namespace: AWS/RDS
      Statistic: Average
      Period: 300
      EvaluationPeriods: 2
      Threshold: 0.15 # 150msï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ã¯å³ã—ã‚ï¼‰
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: DBClusterIdentifier
          Value: !Sub "${ProjectName}-${Environment}-aurora-cluster"
      AlarmActions:
        - !Ref AlertTopic
      TreatMissingData: notBreaching
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-db-read-latency"
        - Key: Environment
          Value: !Ref Environment

  DatabaseWriteLatencyAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: !Sub "${ProjectName}-${Environment}-db-write-latency"
      AlarmDescription: "Aurora ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ›¸ãè¾¼ã¿ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãŒé«˜ã„å ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ"
      MetricName: WriteLatency
      Namespace: AWS/RDS
      Statistic: Average
      Period: 300
      EvaluationPeriods: 2
      Threshold: 0.15 # 150msï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ã¯å³ã—ã‚ï¼‰
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: DBClusterIdentifier
          Value: !Sub "${ProjectName}-${Environment}-aurora-cluster"
      AlarmActions:
        - !Ref AlertTopic
      TreatMissingData: notBreaching
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-db-write-latency"
        - Key: Environment
          Value: !Ref Environment

  # CloudFront ç›£è¦–ç”¨ CloudWatch ã‚¢ãƒ©ãƒ¼ãƒ 
  CloudFrontErrorRateAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: !Sub "${ProjectName}-${Environment}-cloudfront-error-rate"
      AlarmDescription: "CloudFront ã®ã‚¨ãƒ©ãƒ¼ç‡ãŒé«˜ã„å ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ"
      MetricName: ErrorRate
      Namespace: AWS/CloudFront
      Statistic: Average
      Period: 300
      EvaluationPeriods: 2
      Threshold: 3 # 3%ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ã¯å³ã—ã‚ï¼‰
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: DistributionId
          Value:
            Fn::ImportValue: !Sub "${ProjectName}-${Environment}-cloudfront-distribution-id"
      AlarmActions:
        - !Ref AlertTopic
      TreatMissingData: notBreaching
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-cloudfront-error-rate"
        - Key: Environment
          Value: !Ref Environment

  CloudFrontOriginLatencyAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmName: !Sub "${ProjectName}-${Environment}-cloudfront-origin-latency"
      AlarmDescription: "CloudFront ã®ã‚ªãƒªã‚¸ãƒ³ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãŒé«˜ã„å ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆ"
      MetricName: OriginLatency
      Namespace: AWS/CloudFront
      Statistic: Average
      Period: 300
      EvaluationPeriods: 2
      Threshold: 2000 # 2ç§’
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: DistributionId
          Value:
            Fn::ImportValue: !Sub "${ProjectName}-${Environment}-cloudfront-distribution-id"
      AlarmActions:
        - !Ref AlertTopic
      TreatMissingData: notBreaching
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-cloudfront-origin-latency"
        - Key: Environment
          Value: !Ref Environment

  # ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç”¨ CloudWatch ãƒ­ã‚° ã‚°ãƒ«ãƒ¼ãƒ—
  ApplicationMetricsLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub "/aws/lambda/${ProjectName}-${Environment}-custom-metrics"
      RetentionInDays: 30
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-custom-metrics"
        - Key: Environment
          Value: !Ref Environment

  # Slack é€šçŸ¥ç”¨ Lambda é–¢æ•°ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  SlackNotificationFunction:
    Type: AWS::Lambda::Function
    Condition: HasSlackWebhook
    Properties:
      FunctionName: !Sub "${ProjectName}-${Environment}-slack-notification"
      Runtime: python3.11
      Handler: index.lambda_handler
      Role: !GetAtt SlackNotificationRole.Arn
      Timeout: 30
      Environment:
        Variables:
          SLACK_WEBHOOK_URL: !Ref SlackWebhookUrl
          PROJECT_NAME: !Ref ProjectName
          ENVIRONMENT: !Ref Environment
      Code:
        ZipFile: |
          import json
          import urllib3
          import os

          def lambda_handler(event, context):
              """SNS ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ Slack ã«è»¢é€ã™ã‚‹"""
              
              webhook_url = os.environ['SLACK_WEBHOOK_URL']
              project_name = os.environ['PROJECT_NAME']
              environment = os.environ['ENVIRONMENT']
              
              # SNS ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è§£æ
              message = json.loads(event['Records'][0]['Sns']['Message'])
              alarm_name = message.get('AlarmName', 'Unknown')
              new_state = message.get('NewStateValue', 'Unknown')
              reason = message.get('NewStateReason', 'No reason provided')
              
              # Slack ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ§‹ç¯‰
              color = 'danger' if new_state == 'ALARM' else 'good'
              emoji = 'ğŸš¨' if new_state == 'ALARM' else 'âœ…'
              
              slack_message = {
                  'attachments': [{
                      'color': color,
                      'title': f'{emoji} {project_name} ({environment}) - {alarm_name}',
                      'text': f'çŠ¶æ…‹: {new_state}\nç†ç”±: {reason}',
                      'footer': 'AWS CloudWatch',
                      'ts': int(context.aws_request_id[:8], 16)
                  }]
              }
              
              # Slack ã«é€ä¿¡
              http = urllib3.PoolManager()
              response = http.request(
                  'POST',
                  webhook_url,
                  body=json.dumps(slack_message),
                  headers={'Content-Type': 'application/json'}
              )
              
              return {
                  'statusCode': 200,
                  'body': json.dumps('Notification sent to Slack')
              }
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-slack-notification"
        - Key: Environment
          Value: !Ref Environment

  # Slack é€šçŸ¥ç”¨ Lambda å®Ÿè¡Œãƒ­ãƒ¼ãƒ«
  SlackNotificationRole:
    Type: AWS::IAM::Role
    Condition: HasSlackWebhook
    Properties:
      RoleName: !Sub "${ProjectName}-${Environment}-slack-notification-role"
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-slack-notification-role"
        - Key: Environment
          Value: !Ref Environment

  # Slack é€šçŸ¥ç”¨ SNS ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³
  SlackSubscription:
    Type: AWS::SNS::Subscription
    Condition: HasSlackWebhook
    Properties:
      TopicArn: !Ref AlertTopic
      Protocol: lambda
      Endpoint: !GetAtt SlackNotificationFunction.Arn

  # Slack Lambda å®Ÿè¡Œæ¨©é™
  SlackLambdaPermission:
    Type: AWS::Lambda::Permission
    Condition: HasSlackWebhook
    Properties:
      FunctionName: !Ref SlackNotificationFunction
      Action: lambda:InvokeFunction
      Principal: sns.amazonaws.com
      SourceArn: !Ref AlertTopic

Outputs:
  AlertTopicArn:
    Description: ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥ç”¨ SNS ãƒˆãƒ”ãƒƒã‚¯ ARN
    Value: !Ref AlertTopic
    Export:
      Name: !Sub "${ProjectName}-${Environment}-alert-topic-arn"

  ApplicationMetricsLogGroupName:
    Description: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç”¨ãƒ­ã‚° ã‚°ãƒ«ãƒ¼ãƒ—å
    Value: !Ref ApplicationMetricsLogGroup
    Export:
      Name: !Sub "${ProjectName}-${Environment}-custom-metrics-log-group"

  SlackNotificationFunctionArn:
    Condition: HasSlackWebhook
    Description: Slack é€šçŸ¥ç”¨ Lambda é–¢æ•° ARN
    Value: !GetAtt SlackNotificationFunction.Arn
    Export:
      Name: !Sub "${ProjectName}-${Environment}-slack-notification-function-arn"

  MonitoringDashboardUrl:
    Description: CloudWatch ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ URLï¼ˆæ‰‹å‹•ä½œæˆå¾Œã«æ›´æ–°ï¼‰
    Value: !Sub "https://console.aws.amazon.com/cloudwatch/home?region=${AWS::Region}#dashboards:name=${ProjectName}-${Environment}"
    Export:
      Name: !Sub "${ProjectName}-${Environment}-dashboard-url"
