# 実装計画

- [x] 1. プロジェクト構造とコア設定の初期化

  - フロントエンド（Next.js）とバックエンド（FastAPI）のディレクトリ構造を作成
  - TypeScript、Python の基本設定ファイルを作成
  - 環境別設定ファイル（dev/staging/prod）とパラメータ管理を作成
  - 開発環境用の Docker Compose 設定を作成（ローカル MySQL 含む）
  - 環境変数管理とシークレット管理の仕組みを実装
  - _要件: 1.3, 8.1_

- [x] 2. バックエンド API の基盤実装
- [x] 2.1 FastAPI アプリケーションの基本構造を作成

  - FastAPI アプリケーションのエントリーポイントを実装
  - ルーター構造とミドルウェア設定を作成
  - Lambda ハンドラー（Mangum）の統合を実装
  - _要件: 2.2, 5.2_

- [x] 2.2 データベース接続とモデル定義を実装

  - SQLAlchemy ORM 設定と Aurora MySQL 接続を実装
  - User と UserProfile のデータモデルを作成
  - データベースマイグレーション機能を実装
  - _要件: 2.3, 8.3_

- [x] 2.3 認証・認可システムを実装

  - AWS Cognito JWT トークン検証機能を実装
  - API Gateway オーソライザーとの連携を実装
  - 認証デコレーターとミドルウェアを作成
  - _要件: 6.1, 6.2, 6.4_

- [x] 3. API エンドポイントの実装
- [x] 3.1 ユーザー管理 API を実装

  - GET /api/v1/users エンドポイントを実装
  - POST /api/v1/users エンドポイント（ユーザー作成）を実装
  - PUT /api/v1/users/{id} エンドポイント（ユーザー更新）を実装
  - DELETE /api/v1/users/{id} エンドポイントを実装
  - _要件: 2.1, 2.2, 6.4_

- [x] 3.2 認証関連 API を実装

  - POST /api/v1/auth/login エンドポイントを実装
  - POST /api/v1/auth/refresh エンドポイントを実装
  - POST /api/v1/auth/logout エンドポイントを実装
  - _要件: 6.1, 6.3_

- [x] 3.3 ヘルスチェック API を実装

  - GET /api/v1/health エンドポイントを実装
  - データベース接続チェック機能を実装
  - システム状態監視用のメトリクス収集を実装
  - _要件: 5.3, 5.4_

- [ ] 4. フロントエンド アプリケーションの実装
- [x] 4.1 Next.js CSR アプリケーションの基盤を作成

  - Next.js プロジェクトの初期化と設定
  - TypeScript 設定とディレクトリ構造を作成
  - CSR モードの設定と動的インポートを実装
  - _要件: 1.3, 4.1_

- [x] 4.2 API クライアントとデータ管理を実装

  - Axios ベースの API クライアントクラスを実装
  - エラーハンドリングとレスポンス型定義を作成
  - React Context による状態管理を実装
  - _要件: 2.1, 2.4_

- [x] 4.3 認証システムの統合を実装

  - AWS Amplify Auth の設定と初期化
  - ログイン・ログアウト機能を実装
  - 認証状態管理とトークン自動更新を実装
  - 保護されたルートのガード機能を実装
  - _要件: 6.1, 6.3, 6.4_

- [x] 5. UI コンポーネントとページの実装
- [x] 5.1 共通 UI コンポーネントを作成

  - レイアウトコンポーネント（Header, Footer, Navigation）を実装
  - フォームコンポーネント（Input, Button, Form）を実装
  - ローディングとエラー表示コンポーネントを実装
  - _要件: 1.1, 1.3_

- [x] 5.2 認証関連ページを実装

  - ログインページとフォームを実装
  - ユーザー登録ページを実装
  - パスワードリセット機能を実装
  - _要件: 6.1, 6.3_

- [x] 5.3 ユーザー管理ページを実装

  - ユーザー一覧ページを実装
  - ユーザープロファイル表示・編集ページを実装
  - ユーザー検索・フィルタリング機能を実装
  - _要件: 2.1, 2.4_

- [x] 6. テストの実装
- [x] 6.1 バックエンド単体テストを作成

  - FastAPI エンドポイントの単体テストを実装
  - データベースモデルのテストを実装
  - 認証・認可機能のテストを実装
  - _要件: 5.3_

- [x] 6.2 フロントエンド単体テストを作成

  - React コンポーネントの単体テストを実装
  - API クライアントのテストを実装
  - 認証フローのテストを実装
  - _要件: 5.3_

- [x] 6.3 統合テストを実装

  - API エンドポイントの統合テストを実装
  - フロントエンド・バックエンド間の統合テストを実装
  - 認証フロー全体の E2E テストを実装
  - _要件: 5.3_

- [x] 7. AWS インフラストラクチャの実装（環境別）
- [x] 7.1 開発環境のインフラストラクチャを作成

  - 開発用 VPC とネットワーク設定の CloudFormation テンプレートを作成
  - 開発用 Aurora MySQL クラスター（t3.small、暗号化有効）を設定
  - 開発用 Lambda 関数と API Gateway の設定を実装
  - 開発用 S3 バケットと CloudFront の設定を作成
  - _要件: 3.1, 3.2, 8.2, 8.4_

- [x] 7.2 ステージング環境のインフラストラクチャを作成

  - ステージング用 VPC とネットワーク設定を作成（開発環境と分離）
  - ステージング用 Aurora MySQL クラスター（t3.small）を設定
  - ステージング用 Lambda 関数（512MB メモリ）と API Gateway を設定
  - ステージング用 S3 バケットと CloudFront を設定
  - _要件: 3.1, 3.3, 8.3_

- [x] 7.3 本番環境のインフラストラクチャを作成

  - 本番用 VPC とネットワーク設定を作成（完全分離）
  - 本番用 Aurora MySQL クラスター（t3.medium + Read Replica）を設定
  - 本番用 Lambda 関数（1024MB + Provisioned Concurrency）を設定
  - 本番用 S3 バケット、CloudFront、WAF を設定
  - _要件: 3.2, 4.1, 7.2, 7.3_

- [x] 8. API Gateway と CloudFront の設定
- [x] 8.1 API Gateway の設定を実装

  - REST API の CloudFormation 定義を作成
  - Lambda 統合とオーソライザー設定を実装
  - CORS とスロットリング設定を実装
  - _要件: 2.1, 6.2_

- [x] 8.2 S3 と CloudFront の設定を実装

  - S3 バケットの静的ウェブサイトホスティング設定を実装
  - CloudFront ディストリビューションの設定を作成
  - SSL 証明書とカスタムドメイン設定を実装
  - _要件: 1.1, 1.2, 3.4, 3.5_

- [x] 9. CI/CD パイプラインの実装（環境別デプロイ）
- [x] 9.1 開発環境用 CI/CD パイプラインを作成

  - GitHub 連携と開発ブランチ用ソースステージを設定
  - 開発環境用 CodeBuild プロジェクトの設定を実装
  - 開発環境への自動デプロイメントを実装
  - _要件: 5.1, 5.2_

- [x] 9.2 ステージング・本番環境用 CI/CD パイプラインを作成

  - ステージング環境用パイプライン（main ブランチトリガー）を実装
  - 本番環境用パイプライン（手動承認ゲート付き）を実装
  - 環境別ビルドとデプロイスクリプトを作成
  - ロールバック機能とブルーグリーンデプロイを実装
  - _要件: 5.2_

- [ ] 10. 監視とログ設定の実装
- [ ] 10.1 CloudWatch 監視を設定

  - Lambda 関数のメトリクスとアラームを設定
  - Aurora データベースの監視設定を実装
  - CloudFront と API Gateway のログ設定を実装
  - _要件: 5.3, 5.4_

- [ ] 10.2 カスタムメトリクスとダッシュボードを作成

  - アプリケーション固有のメトリクス収集を実装
  - CloudWatch ダッシュボードを作成
  - エラー通知とアラート機能を実装
  - _要件: 5.4_

- [ ] 11. セキュリティ強化とパフォーマンス最適化
- [ ] 11.1 セキュリティ設定を強化

  - WAF ルールの設定を実装
  - セキュリティヘッダーの設定を追加
  - 脆弱性スキャンとセキュリティテストを実装
  - _要件: 3.5, 6.4_

- [ ] 11.2 パフォーマンス最適化を実装

  - Lambda コールドスタート対策を実装
  - データベースクエリ最適化を実行
  - フロントエンドバンドル最適化を実装
  - キャッシング戦略を最適化
  - _要件: 1.4, 4.1, 4.3_

- [ ] 12. 本番環境デプロイと最終検証
- [ ] 12.1 本番環境設定を実装

  - 本番用環境変数と設定を作成
  - Provisioned Concurrency とスケーリング設定を実装
  - 本番用監視とアラート設定を実装
  - _要件: 4.1, 7.2, 7.3_

- [ ] 12.2 最終統合テストと検証を実行

  - 本番環境での動作確認テストを実装
  - パフォーマンステストとロードテストを実行
  - セキュリティテストと脆弱性チェックを実行
  - ドキュメント作成とデプロイ手順書を作成
  - _要件: 5.3, 7.1, 7.4_

- [ ] 13. 日本語開発標準の適用
- [ ] 13.1 コードコメントの日本語化を実装

  - 既存の Python コードに日本語コメントを追加
  - TypeScript コードに日本語コメントを追加
  - 関数・クラスの docstring を日本語で記述
  - _要件: 9.1, 9.4_

- [ ] 13.2 エラーメッセージとログの日本語化を実装

  - バックエンドエラーメッセージを日本語で定義
  - フロントエンドエラーメッセージを日本語で実装
  - ログ出力メッセージを日本語で統一
  - _要件: 9.3, 9.6_

- [ ] 13.3 API ドキュメントの日本語化を実装

  - FastAPI の自動生成ドキュメントを日本語で記述
  - エンドポイントの説明とレスポンス例を日本語で作成
  - OpenAPI スキーマの日本語化を実装
  - _要件: 9.2_

- [ ] 13.4 データベーススキーマコメントの日本語化を実装
  - 既存テーブルに日本語コメントを追加
  - 新規テーブル作成時の日本語コメント標準を適用
  - マイグレーションスクリプトでのコメント追加を実装
  - _要件: 9.5_

## 環境分離の詳細

### 開発環境 (dev)

- **AWS アカウント**: 開発用アカウント（推奨）または本番と同じアカウントの場合は異なるリージョン
- **リソース命名**: `{project-name}-dev-{resource-type}`
- **Aurora**: t3.small、シングル AZ、開発用データ
- **Lambda**: 128MB メモリ、Provisioned Concurrency なし
- **S3/CloudFront**: 開発用ドメイン、基本設定

### ステージング環境 (staging)

- **AWS アカウント**: 本番と同じアカウント、異なる VPC
- **リソース命名**: `{project-name}-staging-{resource-type}`
- **Aurora**: t3.small、マルチ AZ、本番類似データ
- **Lambda**: 512MB メモリ、Provisioned Concurrency なし
- **S3/CloudFront**: ステージング用ドメイン、本番類似設定

### 本番環境 (prod)

- **AWS アカウント**: 本番専用アカウント（推奨）
- **リソース命名**: `{project-name}-prod-{resource-type}`
- **Aurora**: t3.medium + Read Replica、マルチ AZ、暗号化
- **Lambda**: 1024MB メモリ、Provisioned Concurrency 有効
- **S3/CloudFront**: 本番ドメイン、WAF、高可用性設定

## 必要な情報・準備事項

### AWS アカウント情報

- [x] AWS アカウント: 3165071@gmail.com
- [ ] IAM ユーザー/ロールの設定（CloudFormation デプロイ権限）
- [x] リージョン: ap-northeast-1（東京）

### ドメイン・SSL 証明書

- [x] CloudFront デフォルトドメインを使用（無料 HTTPS 対応）
  - 開発: `d{random}.cloudfront.net`
  - ステージング: `d{random}.cloudfront.net`
  - 本番: `d{random}.cloudfront.net`
- [x] API Gateway デフォルトドメインを使用
  - `https://{api-id}.execute-api.ap-northeast-1.amazonaws.com/v1`

### 外部サービス連携

- [x] GitHub リポジトリ: `https://github.com/RikitoMorikawa/project_01.git`（モノレポ構成）
- [ ] CodePipeline 用の GitHub トークン
- [ ] 監視・アラート用の通知先（SNS、Slack など）

### セキュリティ・コンプライアンス

- [ ] セキュリティ要件の確認
- [ ] データ保護・プライバシー要件
- [ ] バックアップ・災害復旧要件

## プロジェクト構成（モノレポ）

```
project_01/
├── frontend/                    # Next.js CSR アプリケーション
│   ├── src/
│   │   ├── components/         # React コンポーネント
│   │   ├── pages/             # Next.js ページ
│   │   ├── hooks/             # カスタムフック
│   │   ├── utils/             # ユーティリティ関数
│   │   └── types/             # TypeScript 型定義
│   ├── public/                # 静的ファイル
│   ├── package.json
│   └── next.config.js
│
├── backend/                     # FastAPI アプリケーション
│   ├── app/
│   │   ├── api/               # API ルーター
│   │   ├── models/            # データモデル
│   │   ├── services/          # ビジネスロジック
│   │   ├── utils/             # ユーティリティ
│   │   └── main.py            # FastAPI エントリーポイント
│   ├── tests/                 # テストファイル
│   ├── requirements.txt
│   └── lambda_handler.py      # Lambda ハンドラー
│
├── infrastructure/              # AWS CloudFormation テンプレート
│   ├── dev/                   # 開発環境用
│   ├── staging/               # ステージング環境用
│   ├── prod/                  # 本番環境用
│   └── shared/                # 共通テンプレート
│
├── .github/
│   └── workflows/             # GitHub Actions CI/CD
│       ├── dev-deploy.yml
│       ├── staging-deploy.yml
│       └── prod-deploy.yml
│
├── docker-compose.yml           # ローカル開発環境
├── README.md
└── .gitignore
```

## 確認済み設定

- ✅ **AWS アカウント**: 3165071@gmail.com
- ✅ **GitHub リポジトリ**: https://github.com/RikitoMorikawa/project_01.git
- ✅ **ドメイン**: CloudFront/API Gateway デフォルトドメイン使用（無料）
- ✅ **リポジトリ構成**: モノレポ（フロント・バック統合管理）
- ✅ **リージョン**: ap-northeast-1（東京）
